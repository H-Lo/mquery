/* mQuery 0.4 (nightly) (5/22/2022, 9:36:26 AM), vitmalina@gmail.com */
class Query{constructor(e,t,r){this.version=.4,this.context=t??document,this.previous=r??null;let s=[];if(Array.isArray(e))s=e;else if(Query._isEl(e))s=[e];else if(e instanceof Query)s=e.nodes;else if("string"==typeof e){if("function"!=typeof this.context.querySelector)throw new Error("Invalid context");s=Array.from(this.context.querySelectorAll(e))}else if(null==e)s=[];else{r=Array.from(e??[]);if("object"!=typeof e||!Array.isArray(r))throw new Error(`Invalid selector "${e}"`);s=r}this.nodes=s,this.length=s.length,this.each((e,t)=>{this[t]=e})}static _isEl(e){return e instanceof Document||e instanceof DocumentFragment||e instanceof HTMLElement||e instanceof Text}static _fragment(e){let t=document.createElement("template");return t.innerHTML=e,t.content}_insert(n,r){let i=[],o=this.length;if(!(o<1)){var t=Query._isEl(r);let e=this;if("string"==typeof r)this.each(e=>{var t=Query._fragment(r);i.push(...t.childNodes),e[n](t)});else if(r instanceof Query){let s=1==o&&1==r.length;r.each(r=>{this.each(e=>{var t=s?r:r.cloneNode(!0);e[n](t),i.push(t)})}),s||r.remove()}else{if(!t)throw new Error(`Incorrect argument for "${n}(html)". It expects one string argument.`);this.each(e=>{var t=1===o?r:Query._fragment(r.outerHTML);i.push(...1===o?[r]:t.childNodes),e[n](t)}),1<o&&r.remove()}return"replaceWith"==n&&(e=new Query(i,this.context,this)),e}}_save(e,t,r){e._mQuery=e._mQuery??{},Array.isArray(r)?(e._mQuery[t]=e._mQuery[t]??[],e._mQuery[t].push(...r)):null!=r?e._mQuery[t]=r:delete e._mQuery[t]}get(e){var t=this[e=e<0?this.length+e:e];return t||(null!=e?null:this.nodes)}eq(e){let t=[this[e=e<0?this.length+e:e]];return null==t[0]&&(t=[]),new Query(t,this.context,this)}then(e){e=e(this);return null!=e?e:this}find(t){let r=[];return this.each(e=>{e=Array.from(e.querySelectorAll(t));0<e.length&&r.push(...e)}),new Query(r,this.context,this)}filter(t){let r=[];return this.each(e=>{(e===t||"string"==typeof t&&e.matches&&e.matches(t)||"function"==typeof t&&t(e))&&r.push(e)}),new Query(r,this.context,this)}next(){let t=[];return this.each(e=>{e=e.nextElementSibling;e&&t.push(e)}),new Query(t,this.context,this)}prev(){let t=[];return this.each(e=>{e=e.previousElementSibling;e&&t.push(e)}),new Query(t,this.context,this)}shadow(e){let t=[];this.each(e=>{e.shadowRoot&&t.push(e.shadowRoot)});let r=new Query(t,this.context,this);return e?r.find(e):r}closest(t){let r=[];return this.each(e=>{e=e.closest(t);e&&r.push(e)}),new Query(r,this.context,this)}host(t){let r=[],s=e=>e.parentNode?s(e.parentNode):e,n=e=>{e=s(e);r.push(e.host||e),e.host&&t&&n(e.host)};return this.each(e=>{n(e)}),new Query(r,this.context,this)}parent(e){return this.parents(e,!0)}parents(e,t){let r=[],s=e=>{if(-1==r.indexOf(e)&&r.push(e),!t&&e.parentNode)return s(e.parentNode)};this.each(e=>{e.parentNode&&s(e.parentNode)});let n=new Query(r,this.context,this);return e?n.filter(e):n}each(r){return this.nodes.forEach((e,t)=>{r(e,t,this)}),this}append(e){return this._insert("append",e)}prepend(e){return this._insert("prepend",e)}after(e){return this._insert("after",e)}before(e){return this._insert("before",e)}replace(e){return this._insert("replaceWith",e)}remove(){return this.each(e=>{e.remove()}),this}css(t,e){let s=t;var r=arguments.length;if(0!==r&&(1!==r||"string"!=typeof t))return"object"!=typeof t&&(s={},s[t]=e),this.each((r,e)=>{Object.keys(s).forEach(e=>{var t=String(s[e]).toLowerCase().includes("!important")?"important":"";r.style.setProperty(e,String(s[e]).replace(/\!important/i,""),t)})}),this;if(this[0]){let e=this[0].style;if("string"!=typeof t)return Object.fromEntries(this[0].style.cssText.split(";").filter(e=>!!e).map(e=>e.split(":").map(e=>e.trim())));r=e.getPropertyPriority(t);return e.getPropertyValue(t)+(r?"!"+r:"")}}addClass(e){return this.toggleClass(e,!0),this}removeClass(e){return this.toggleClass(e,!1),this}toggleClass(t,s){return"string"==typeof t&&(t=t.split(/[,\s]+/)),this.each(r=>{let e=t;null==e&&!1===s&&(e=Array.from(r.classList)),e.forEach(t=>{if(""!==t){let e=null!=s?s?"add":"remove":"toggle";r.classList[e](t)}})}),this}hasClass(e){if(null==(e="string"==typeof e?e.split(/[,\s]+/):e)&&0<this.length)return Array.from(this[0].classList);let r=!1;return this.each(t=>{r=r||e.every(e=>Array.from(t.classList).includes(e))}),r}on(e,s,n){"function"==typeof s&&(n=s,s=void 0);let i;return s?.delegate&&(i=s.delegate,delete s.delegate),(e=e.split(/[,\s]+/)).forEach(e=>{let[t,r]=String(e).toLowerCase().split(".");if(i){let r=n;n=e=>{var t=query(e.target).parents(i);0<t.length?e.delegate=t[0]:e.delegate=e.target,(e.target.matches(i)||0<t.length)&&r(e)}}this.each(e=>{this._save(e,"events",[{event:t,scope:r,callback:n,options:s}]),e.addEventListener(t,n,s)})}),this}off(e,t,i){return"function"==typeof t&&(i=t,t=void 0),(e=e.split(/[,\s]+/)).forEach(e=>{let[s,n]=String(e).toLowerCase().split(".");this.each(t=>{if(Array.isArray(t._mQuery?.events))for(let e=t._mQuery.events.length-1;0<=e;e--){var r=t._mQuery.events[e];null==n||""===n?r.event!=s||r.scope!=n||r.callback!=i&&null!=i||(t.removeEventListener(s,r.callback,r.options),t._mQuery.events.splice(e,1)):r.event!=s&&""!==s||r.scope!=n&&"*"!==n||(t.removeEventListener(r.event,r.callback,r.options),t._mQuery.events.splice(e,1))}})}),this}trigger(e,t){let r;return r=e instanceof Event||e instanceof CustomEvent?e:new(["click","dblclick","mousedown","mouseup","mousemove"].includes(e)?MouseEvent:["keydown","keyup","keypress"].includes(e)?KeyboardEvent:Event)(e,t),this.each(e=>{e.dispatchEvent(r)}),this}attr(t,r){if(void 0===r&&"string"==typeof t)return this[0]?this[0].getAttribute(t):void 0;{let e={};return"object"==typeof t?e=t:e[t]=r,this.each(r=>{Object.entries(e).forEach(([e,t])=>{r.setAttribute(e,t)})}),this}}removeAttr(){return this.each(t=>{Array.from(arguments).forEach(e=>{t.removeAttribute(e)})}),this}prop(t,r){if(void 0===r&&"string"==typeof t)return this[0]?this[0][t]:void 0;{let e={};return"object"==typeof t?e=t:e[t]=r,this.each(r=>{Object.entries(e).forEach(([e,t])=>{r[e]=t})}),this}}removeProp(){return this.each(t=>{Array.from(arguments).forEach(e=>{delete t[e]})}),this}data(r,t){if(r instanceof Object)Object.entries(r).forEach(e=>{this.data(e[0],e[1])});else{if(r&&-1!=r.indexOf("-")&&console.error(`Key "${r}" contains "-" (dash). Dashes are not allowed in property names. Use camelCase instead.`),!(arguments.length<2))return this.each(e=>{null!=t?e.dataset[r]=t instanceof Object?JSON.stringify(t):t:delete e.dataset[r]}),this;if(this[0]){let t=Object.assign({},this[0].dataset);return Object.keys(t).forEach(e=>{if(t[e].startsWith("[")||t[e].startsWith("{"))try{t[e]=JSON.parse(t[e])}catch(e){}}),r?t[r]:t}}}removeData(t){return this.each(e=>{delete e.dataset[t]}),this}show(){return this.toggle(!0)}hide(){return this.toggle(!1)}toggle(n){return this.each(e=>{var t=e.style.display,r=getComputedStyle(e).display,s="none"==t||"none"==r;!s||null!=n&&!0!==n||(e.style.display=e._mQuery?.prevDisplay??(t==r?"":"block"),this._save(e,"prevDisplay",null)),s||null!=n&&!1!==n||("none"!=r&&this._save(e,"prevDisplay",r),e.style.setProperty("display","none"))})}empty(){return this.html("")}html(e){return this.prop("innerHTML",e)}text(e){return this.prop("textContent",e)}val(e){return this.prop("value",e)}change(){return this.trigger("change")}click(){return this.trigger("click")}}let query=function(e,t){if("function"!=typeof e)return new Query(e,t);"complete"==document.readyState?e():window.addEventListener("load",e)};query.html=e=>{e=Query._fragment(e);return query(e.children,e)};export{query as $,query as default,query,Query};