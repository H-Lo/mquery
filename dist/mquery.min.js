/* mQuery 0.3 (nightly) (2/11/2022, 7:59:34 AM), vitmalina@gmail.com */
class Query{constructor(e,t,r){this.version=.4,this.context=t??document,this.previous=r??null;let s=[];if(Array.isArray(e))s=e;else if(Query._isEl(e))s=[e];else if(e instanceof Query)s=e.nodes;else if("string"==typeof e){if("function"!=typeof this.context.querySelector)throw new Error("Invalid context");s=Array.from(this.context.querySelectorAll(e))}else{r=Array.from(e);if("object"!=typeof e||!Array.isArray(r))throw new Error(`Invalid selector "${e}"`);s=r}this.nodes=s,this.length=s.length,this.each((e,t)=>{this[t]=e})}static _isEl(e){return e instanceof DocumentFragment||e instanceof HTMLElement||e instanceof Text}static _fragment(e){let t=document.createElement("template");return t.innerHTML=e,t.content}_insert(s,i){let n=[],h=this.length;if(!(h<1)){let r=Query._isEl(i),e=this;if("string"==typeof i)this.each(e=>{var t=Query._fragment(i);"replaceWith"==s&&n.push(...t.childNodes),e[s](t)}),"replaceWith"==s&&(e=new Query(n,this.context,this));else{if(!r)throw new Error(`Incorrect argument for "${s}(html)". It expects one string argument.`);this.each(e=>{var t=Query._fragment(i.outerHTML);e[s](1===h?i:t),1<h&&r&&n.push(...t.childNodes)}),1<h&&r&&i.remove()}return e}}_save(e,t,r){e._mQuery=e._mQuery??{},Array.isArray(r)&&(e._mQuery[t]=e._mQuery[t]??[],e._mQuery[t].push(...r)),null==r?delete e._mQuery[t]:e._mQuery[t]=r}get(e){e=this[e=e<0?this.length+e:e];return e||this.nodes}eq(e){let t=[this[e=e<0?this.length+e:e]];return null==t[0]&&(t=[]),new Query(t,this.context,this)}find(t){let r=[];return this.each(e=>{e=Array.from(e.querySelectorAll(t));0<e.length&&r.push(...e)}),new Query(r,this.context,this)}filter(t){let r=[];return this.each(e=>{(e===t||"string"==typeof t&&e.matches(t)||"function"==typeof t&&t(e))&&r.push(e)}),new Query(r,this.context,this)}shadow(e){let t=[];this.each(e=>{e.shadowRoot&&t.push(e.shadowRoot)});let r=new Query(t,this.context,this);return e?r.find(e):r}closest(t){let r=[];return this.each(e=>{e=e.closest(t);e&&r.push(e)}),new Query(r,this.context,this)}host(t){let r=[],s=e=>e.parentNode?s(e.parentNode):e,i=e=>{e=s(e);r.push(e.host||e),e.host&&t&&i(e.host)};return this.each(e=>{i(e)}),new Query(r,this.context,this)}each(r){return this.nodes.forEach((e,t)=>{r(e,t,this)}),this}append(e){return this._insert("append",e)}prepend(e){return this._insert("prepend",e)}after(e){return this._insert("after",e)}before(e){return this._insert("before",e)}replace(e){return this._insert("replaceWith",e)}remove(){return this.each(e=>{e.remove()}),this}css(e,t){let r=e;var s=arguments.length;return 0===s||1===s&&"string"==typeof e?this[0]?"string"==typeof e?this[0].style[e]:Object.fromEntries(this[0].style.cssText.split(";").filter(e=>!!e).map(e=>e.split(":").map(e=>e.trim()))):void 0:("object"!=typeof e&&(r={},r[e]=t),this.each((t,e)=>{Object.keys(r).forEach(e=>{t.style[e]=r[e]})}),this)}addClass(e){return this.toggleClass(e,!0),this}removeClass(e){return this.toggleClass(e,!1),this}toggleClass(t,s){return"string"==typeof t&&(t=t.split(/[ ,]+/)),this.each(r=>{let e=t;null==e&&!1===s&&(e=Array.from(r.classList)),e.forEach(t=>{if(""!==t){let e=null!=s?s?"add":"remove":"toggle";r.classList[e](t)}})}),this}hasClass(e){if(null==(e="string"==typeof e?e.split(/[ ,]+/):e)&&0<this.length)return Array.from(this[0].classList);let r=!1;return this.each(t=>{r=r||e.every(e=>Array.from(t.classList).includes(e))}),r}on(e,t,r){let[s,i]=String(e).toLowerCase().split(".");return"function"==typeof t&&(r=t,t=void 0),this.each(e=>{this._save(e,"events",[{event:s,scope:i,callback:r,options:t}]),e.addEventListener(s,r,t)}),this}off(e,s,i){let[n,h]=String(e).toLowerCase().split(".");return"function"==typeof s&&(i=s,s=void 0),this.each(t=>{if(t._mQuery&&Array.isArray(t._mQuery.events))for(let e=t._mQuery.events.length-1;0<=e;e--){var r=t._mQuery.events[e];null==h||""===h?r.event==n&&r.scope==h&&r.callback==i&&(t.removeEventListener(n,i,s),t._mQuery.events.splice(e,1)):r.event!=n&&""!==n||r.scope!=h&&"*"!==h||(t.removeEventListener(r.event,r.callback,r.options),t._mQuery.events.splice(e,1))}}),this}trigger(e,t){let r;return r=e instanceof Event||e instanceof CustomEvent?e:new(["click","dblclick","mousedown","mouseup","mousemove"].includes(e)?MouseEvent:["keydown","keyup","keypress"].includes(e)?KeyboardEvent:Event)(e,t),this.each(e=>{e.dispatchEvent(r)}),this}attr(t,r){if(void 0===r&&"string"==typeof t)return this[0]?this[0].getAttribute(t):void 0;{let e={};return"object"==typeof t?e=t:e[t]=r,this.each(r=>{Object.entries(e).forEach(([e,t])=>{r.setAttribute(e,t)})}),this}}removeAttr(){return this.each(t=>{Array.from(arguments).forEach(e=>{t.removeAttribute(e)})}),this}prop(t,r){if(void 0===r&&"string"==typeof t)return this[0]?this[0][t]:void 0;{let e={};return"object"==typeof t?e=t:e[t]=r,this.each(r=>{Object.entries(e).forEach(([e,t])=>{r[e]=t})}),this}}removeProp(){return this.each(t=>{Array.from(arguments).forEach(e=>{delete t[e]})}),this}data(t,r){if(!(arguments.length<2))return this.each(e=>{e._mQuery=e._mQuery??{},e._mQuery.data=e._mQuery.data??{},null!=r?e._mQuery.data[t]=r:delete e._mQuery.data[t]}),this;if(this[0]){let s=this[0]._mQuery?.data??{};return Array.from(this[0].attributes).forEach(r=>{if("data-"==r.name.substr(0,5)){let t=r.value;var e=r.name.substr(5);if(["[","{"].includes(String(t).substr(0,1)))try{t=JSON.parse(t)}catch(e){t=r.value}void 0===s[e]&&(s[e]=t)}}),t?s[t]:s}}removeData(t){return this.each(e=>{e._mQuery=e._mQuery??{},0!=arguments.length&&null!=t&&e._mQuery.data?delete e._mQuery.data[t]:e._mQuery.data={}}),this}show(){return this.each(e=>{var t=e._mQuery.prevDisplay;e.style.display=t??"inherit",this._save(e,"prevDisplay",void 0)})}hide(){return this.each(e=>{var t=e.style.display;"none"!=t&&this._save(e,"prevDisplay",t),e.style.display="none"})}empty(){return this.html("")}html(e){return this.prop("innerHTML",e)}text(e){return this.prop("textContent",e)}val(e){return this.attr("value",e)}toggle(){var e=this.css("display");return this.css("display","none"==e?"inherit":"none")}change(){return this.trigger("change")}click(){return this.trigger("click")}}let query=function(e,t){if("function"!=typeof e)return new Query(e,t);window.addEventListener("load",e)};query.html=e=>Query._fragment(e);export{query as $,query as default,query,Query};